<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Designing an Embedded Insurance Platform | Ankul Choudhry</title><meta name=keywords content="system-design,insurance,platform-engineering,architecture,fintech"><meta name=description content="Architecture blueprint for EMs and Staff Engineers building embedded insurance platforms — product engines, policy issuance, financial ledgers, claims workflows, and IRDAI-ready reporting."><meta name=author content="Ankul Choudhry"><link rel=canonical href=https://ankul01.github.io/profile/posts/tech-blogs/embedded-insurance/><link crossorigin=anonymous href=/profile/assets/css/stylesheet.79b8178cf3b2a84156cb542a4ce74f1a58965e141d7213fad007ddc7e1b15ee3.css integrity="sha256-ebgXjPOyqEFWy1QqTOdPGliWXhQdchP60Afdx+GxXuM=" rel="preload stylesheet" as=style><link rel=icon href=https://ankul01.github.io/profile/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ankul01.github.io/profile/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ankul01.github.io/profile/favicon-32x32.png><link rel=apple-touch-icon href=https://ankul01.github.io/profile/apple-touch-icon.png><link rel=mask-icon href=https://ankul01.github.io/profile/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ankul01.github.io/profile/posts/tech-blogs/embedded-insurance/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://ankul01.github.io/profile/posts/tech-blogs/embedded-insurance/"><meta property="og:site_name" content="Ankul Choudhry"><meta property="og:title" content="Designing an Embedded Insurance Platform"><meta property="og:description" content="Architecture blueprint for EMs and Staff Engineers building embedded insurance platforms — product engines, policy issuance, financial ledgers, claims workflows, and IRDAI-ready reporting."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-02-14T00:00:00+00:00"><meta property="article:modified_time" content="2026-02-14T00:00:00+00:00"><meta property="article:tag" content="System-Design"><meta property="article:tag" content="Insurance"><meta property="article:tag" content="Platform-Engineering"><meta property="article:tag" content="Architecture"><meta property="article:tag" content="Fintech"><meta name=twitter:card content="summary"><meta name=twitter:title content="Designing an Embedded Insurance Platform"><meta name=twitter:description content="Architecture blueprint for EMs and Staff Engineers building embedded insurance platforms — product engines, policy issuance, financial ledgers, claims workflows, and IRDAI-ready reporting."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ankul01.github.io/profile/posts/"},{"@type":"ListItem","position":2,"name":"Tech Blogs","item":"https://ankul01.github.io/profile/posts/tech-blogs/"},{"@type":"ListItem","position":3,"name":"Designing an Embedded Insurance Platform","item":"https://ankul01.github.io/profile/posts/tech-blogs/embedded-insurance/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Designing an Embedded Insurance Platform","name":"Designing an Embedded Insurance Platform","description":"Architecture blueprint for EMs and Staff Engineers building embedded insurance platforms — product engines, policy issuance, financial ledgers, claims workflows, and IRDAI-ready reporting.","keywords":["system-design","insurance","platform-engineering","architecture","fintech"],"articleBody":"What is Embedded Insurance? Embedded insurance is a distribution model where insurance is integrated directly into a primary product or transaction journey — rather than sold separately through agents or aggregators.\nReal-world examples:\nDevice protection offered during mobile checkout Loan protection bundled with credit disbursement Travel insurance embedded in ticket booking Health cover attached to a subscription plan Unlike traditional agency or bancassurance models, embedded insurance is:\nPartner-distributed — e-commerce, fintech, NBFC, and travel platforms sell the product API-driven and real-time — no manual underwriting delays SKU-based — sellable units attached to transactions Operated under a Master Policy + Certificate of Insurance (COI) structure Highly automated — across issuance, finance, and claims Key Structural Concepts Before diving into architecture, these domain concepts are essential:\nConcept Definition Master Policy A single contract issued to the partner (or aggregator) covering a defined cohort of customers Certificate of Insurance (COI) Individual proof of coverage issued to each insured under the master policy SKU The smallest sellable unit — a versioned plan with specific covers and pricing rules Cover Risk type (e.g., accidental damage, hospitalization, death) Benefit Payout construct within a cover Underwriting Assumed as a black-box service that returns eligibility and pricing modifiers Part 1 — Platform Architecture Blueprint Product Hierarchy \u0026 SKU Design This is the foundation of configurability. The product engine must support multiple lines of business (LOBs) without LOB-specific code.\nProduct └── Plan (Versioned) └── Cover └── Benefit └── Configurations Example SKU:\n{ \"sku_id\": \"LOAN_PROTECT_V3\", \"lob\": \"credit_life\", \"covers\": [ { \"type\": \"death_cover\", \"sum_insured_formula\": \"loan_outstanding\" } ], \"pricing_model\": \"grid_v2\", \"eligibility_profile\": \"loan_basic_rules\" } Design Principles:\nVersioning is mandatory. Plans must be immutable once published. Never modify live plans — create a new version, soft-deprecate the old one, and maintain backward compatibility.\nPartner overlays stay separate. Partners may require custom pricing, modified eligibility, or commission overrides. Keep overrides in a separate layer from the base product definition:\nBase Plan + Partner Override Layer Integrations Layer Embedded insurance must support multiple integration modes to serve different partner types.\nAPI-Based (Real-Time) Used by e-commerce, fintech lending, BNPL, and wallet integrations.\nPartner → Proposal API → Eligibility → Pricing → Issuance → COI Design requirements:\nIdempotency keys on every mutating call Versioned APIs Async event notifications (webhooks) Timeout-safe retry logic POS / SDK Integrations Used for offline stores and agent-assisted selling:\nToken-based authentication Embedded UI SDK with local validation + backend confirmation Offline (SFTP / Batch) Used by NBFCs and enterprise partners:\nBatch file upload → Validation pipeline → Pricing + Eligibility → Bulk issuance → Reconciliation report Must include file checksum validation, row-level error reporting, and reprocessing capability Pricing Engine (Grid-Based) Embedded insurance typically uses grid-based pricing rather than actuarial models at runtime.\nExample pricing grid:\nAge Band Loan Tenure Rate 18–40 \u003c 24 months 0.8% 41–60 \u003c 24 months 1.2% 18–40 \u003e 24 months 1.1% Resolution flow:\nPricing Input → Grid Resolver → Rate Selection → Premium Calculator Key considerations:\nGrid versioning (old grids must remain queryable) Partner-level overrides Preloading grids in memory for performance Formula abstraction — no hardcoded logic Eligibility Engine Eligibility rules can be static (mandatory field validation), rule-based (config-driven), or underwriting-triggered (external service).\nExample Rule DSL:\nIF loan_amount \u003e 5L THEN reject IF age \u003e 65 THEN reject IF pincode IN blacklist THEN reject Fail strategy:\nFail-closed — reject if rules are unavailable (preferred for insurance) Fail-open — allow issuance if non-critical (only with explicit approval) Failure Handling Embedded insurance platforms must handle complex failure scenarios gracefully.\nScenario Strategy Payment success, issuance failure Compensation workflow → Retry issuance → If irrecoverable, trigger refund + reversal entry PAS (Policy Admin System) timeout Async confirmation → Track pending_issuance state → Reconcile via event listener Duplicate requests Idempotency keys + unique proposal reference ID + state-based validation Float Balance / Partner Ledger Two common financial models:\nModel How It Works Pre-funded (Float) Partner maintains a balance. Debit float → Issue policy Post-paid Commission Insurer settles commission periodically Float ledger design (high-level):\npartner_wallet: | partner_id | balance | wallet_transactions: | txn_id | partner_id | debit | credit | reference_id | Settlement cycle: Daily premium collection summary → Commission deduction → Net settlement report.\nThe ledger must be immutable.\nCertificate of Insurance (COI) COI lifecycle:\nPolicy Issued → Data bound to template → PDF generated → Stored in object storage → URL returned Design requirements:\nVersioned templates with dynamic placeholders Template audit trail Re-generation capability Must reference: master policy number, certificate number, coverage details Claims System FNOL → Documents Pending → Assessment → Approved / Rejected → Paid Key data points per claim: Claim ID, Policy reference, Reserve amount, Paid amount, Fraud flags.\nReserve vs Paid — Reserve is the expected liability; Paid is the actual settlement. Reserve tracking is critical for regulatory reporting.\nReporting Architecture Embedded insurance must support both regulatory (IRDAI) and partner reporting.\nCore registers:\nRegister Key Fields Premium Register policy_id, premium, tax, net Claims Paid Register claim_id, amount_paid, payout_date Claims Reserve Register claim_id, reserve_amount Commission Register partner_id, commission_amount Architecture:\nOperational DB → Event Stream → Reporting Warehouse → Regulatory / Partner Reports Never run heavy reports on the transactional database.\nIRDAI reporting considerations: Monthly premium summaries, claim ratio reporting, product-wise data segregation, audit-ready exports.\nPart 2 — Domain Model \u0026 Entity-Relationship Design This section maps the architecture into a production-grade domain model, organized by bounded context.\nBounded Contexts The platform is organized into 6 isolated contexts:\nProduct Configuration — Product, Plan, Cover, Benefit, SKU Pricing \u0026 Eligibility — Grid models, rule definitions Policy \u0026 Issuance — Proposal, Underwriting, Policy, Certificate Claims — Claim lifecycle, documents, payments Finance \u0026 Ledger — Double-entry accounts, float wallet Partner \u0026 Overlay — Partner config, plan overrides Product \u0026 SKU Entities product id UUID name string lob string (device / health / credit) status enum (draft / active / deprecated) plan id UUID product_id FK(product) version integer effective_from date effective_to date status enum ← Immutable once active plan_cover id UUID plan_id FK(plan) cover_type string sum_insured_formula string cover_benefit id UUID plan_cover_id FK(plan_cover) benefit_type string payout_logic json sku id UUID plan_id FK(plan) sku_code string pricing_model_id FK(pricing_model) eligibility_profile_id FK(eligibility_profile) SKU is the sellable layer — the unit partners interact with.\nPricing \u0026 Eligibility Entities pricing_model id UUID type enum(grid / formula) version integer pricing_grid id UUID pricing_model_id FK param_1 string param_2 string rate decimal eligibility_profile id UUID rule_definition json version integer ← Rules stored as DSL JSON Proposal → Policy Issuance Entities Proposal → Underwriting Decision → Policy → Certificate proposal id UUID partner_id FK(partner) sku_id FK(sku) status enum(draft / submitted / approved / rejected) premium_amount decimal meta json underwriting_decision id UUID proposal_id FK decision enum(approved / rejected / manual) score decimal reason string policy id UUID master_policy_id FK(master_policy) proposal_id FK policy_number string status enum(issued / active / cancelled / expired) start_date date end_date date certificate id UUID policy_id FK certificate_number string pdf_url string template_version integer master_policy id UUID insurer_reference string partner_id FK product_id FK start_date date end_date date Claims Entities Policy → Claim → Claim_Event / Claim_Document / Claim_Payment claim id UUID policy_id FK status enum loss_date date reserve_amount decimal approved_amount decimal claim_event id UUID claim_id FK event_type string created_at timestamp claim_document id UUID claim_id FK doc_type string storage_url string claim_payment id UUID claim_id FK amount decimal payout_date date payment_reference string Finance \u0026 Ledger Entities This is the most critical section. Never mix business tables with ledger tables.\nledger_account id UUID account_type enum(premium_receivable, insurer_payable, commission_payable, claims_payable) owner_type enum(system, partner, insurer) owner_id UUID ledger_entry ← IMMUTABLE TABLE id UUID debit_account_id FK credit_account_id FK amount decimal reference_type enum(policy, claim, refund) reference_id UUID created_at timestamp Float wallet:\npartner_wallet partner_id UUID balance decimal wallet_txn id UUID partner_id UUID debit decimal credit decimal reference_id UUID Partner \u0026 Overlay Entities partner id UUID name string integration_mode enum(api / pos / batch) partner_plan_override id UUID partner_id FK sku_id FK pricing_override json commission_override decimal Full Platform ER Diagram Below is the complete entity-relationship diagram in Mermaid syntax. You can render it in any Mermaid-compatible tool.\nerDiagram %% ── PARTNER CONTEXT ── PARTNER { UUID id string name string integration_mode } MASTER_POLICY { UUID id UUID partner_id UUID product_id string insurer_reference date start_date date end_date } PARTNER ||--o{ MASTER_POLICY : owns %% ── PRODUCT CONFIGURATION ── PRODUCT { UUID id string name string lob string status } PLAN { UUID id UUID product_id int version date effective_from date effective_to string status } PLAN_COVER { UUID id UUID plan_id string cover_type string sum_insured_formula } COVER_BENEFIT { UUID id UUID plan_cover_id string benefit_type json payout_logic } SKU { UUID id UUID plan_id string sku_code UUID pricing_model_id UUID eligibility_profile_id } PRODUCT ||--o{ PLAN : contains PLAN ||--o{ PLAN_COVER : defines PLAN_COVER ||--o{ COVER_BENEFIT : includes PLAN ||--o{ SKU : sellable_unit %% ── PRICING \u0026 ELIGIBILITY ── PRICING_MODEL { UUID id string type int version } PRICING_GRID { UUID id UUID pricing_model_id string param_1 string param_2 decimal rate } ELIGIBILITY_PROFILE { UUID id json rule_definition int version } PRICING_MODEL ||--o{ PRICING_GRID : defines SKU }o--|| PRICING_MODEL : uses SKU }o--|| ELIGIBILITY_PROFILE : validated_by %% ── PROPOSAL \u0026 POLICY ── PROPOSAL { UUID id UUID partner_id UUID sku_id string status decimal premium_amount json meta } UNDERWRITING_DECISION { UUID id UUID proposal_id string decision decimal score string reason } POLICY { UUID id UUID master_policy_id UUID proposal_id string policy_number string status date start_date date end_date } CERTIFICATE { UUID id UUID policy_id string certificate_number string pdf_url int template_version } PARTNER ||--o{ PROPOSAL : initiates SKU ||--o{ PROPOSAL : selected_in PROPOSAL ||--|| UNDERWRITING_DECISION : evaluated_by PROPOSAL ||--|| POLICY : converts_to MASTER_POLICY ||--o{ POLICY : governs POLICY ||--|| CERTIFICATE : generates %% ── CLAIMS CONTEXT ── CLAIM { UUID id UUID policy_id string status date loss_date decimal reserve_amount decimal approved_amount } CLAIM_EVENT { UUID id UUID claim_id string event_type datetime created_at } CLAIM_DOCUMENT { UUID id UUID claim_id string doc_type string storage_url } CLAIM_PAYMENT { UUID id UUID claim_id decimal amount date payout_date } POLICY ||--o{ CLAIM : triggers CLAIM ||--o{ CLAIM_EVENT : tracks CLAIM ||--o{ CLAIM_DOCUMENT : attaches CLAIM ||--o{ CLAIM_PAYMENT : settles %% ── FINANCE \u0026 LEDGER ── LEDGER_ACCOUNT { UUID id string account_type string owner_type UUID owner_id } LEDGER_ENTRY { UUID id UUID debit_account_id UUID credit_account_id decimal amount string reference_type UUID reference_id datetime created_at } LEDGER_ACCOUNT ||--o{ LEDGER_ENTRY : participates POLICY ||--o{ LEDGER_ENTRY : premium_related CLAIM ||--o{ LEDGER_ENTRY : payout_related %% ── PARTNER FLOAT WALLET ── PARTNER_WALLET { UUID partner_id decimal balance } WALLET_TXN { UUID id UUID partner_id decimal debit decimal credit UUID reference_id } PARTNER ||--|| PARTNER_WALLET : has PARTNER_WALLET ||--o{ WALLET_TXN : records %% ── REPORTING LAYER ── PREMIUM_REGISTER { UUID policy_id decimal premium decimal tax decimal net } CLAIMS_PAID_REGISTER { UUID claim_id decimal amount_paid } CLAIMS_RESERVE_REGISTER { UUID claim_id decimal reserve_amount } COMMISSION_REGISTER { UUID partner_id decimal commission } POLICY ||--o{ PREMIUM_REGISTER : reported_in CLAIM ||--o{ CLAIMS_PAID_REGISTER : reported_in CLAIM ||--o{ CLAIMS_RESERVE_REGISTER : reported_in PARTNER ||--o{ COMMISSION_REGISTER : earns Relationship Summary Partner └── Master_Policy └── Policy └── Certificate └── Claim → Claim_Payment Product └── Plan └── SKU └── Proposal → Policy Policy / Claim → Ledger_Entry Part 3 — End-to-End Issuance Flow This section moves from static design to runtime system behavior. We walk through a complete issuance cycle for a loan protection product using a pre-funded float model.\nScenario: Partner is an NBFC. Product is Loan Protection Insurance. Financial model is pre-funded float. Underwriting is abstracted (assume approval).\nHigh-Level Flow Partner → Proposal API → Eligibility → Pricing → Underwriting ↓ Policy Issuance ↓ Ledger Posting (Premium, Commission, Insurer Payable) ↓ COI Generation ↓ Event Emission ↓ Reporting Pipeline Step 1: Proposal Creation API request:\n{ \"partner_id\": \"NBFC_X\", \"sku_id\": \"LOAN_PROTECT_V3\", \"insured\": { \"loan_amount\": 500000, \"tenure\": 36, \"age\": 32 }, \"idempotency_key\": \"loan_12345\" } System actions:\nValidate partner Fetch SKU + plan version Run eligibility rules Resolve pricing grid Call underwriting engine (abstracted) Persist proposal Database writes:\nTable id status premium proposal P1 approved 4500 Table proposal_id decision underwriting_decision P1 approved Step 2: Policy Issuance Issuance must be idempotent. Issuance and ledger posting must occur in a single atomic transaction or with event-sourced compensation.\nDatabase writes:\nTable id proposal_id status policy POL1 P1 issued Table id policy_id certificate_no certificate C1 POL1 CERT_123 Step 3: Ledger Posting (Financial Core) This is where most naive systems fail.\nAssume: Premium = 4500, Commission = 900, Insurer share = 3600.\nLedger accounts involved:\nAccount Owner Premium Receivable System Insurer Payable Insurer Partner Commission Payable Partner Partner Float Wallet Partner Journal entries (double-entry):\nEntry 1 — Deduct float:\nDebit: Partner Float Wallet 4500 Credit: Premium Receivable 4500 Entry 2 — Allocate premium to insurer:\nDebit: Premium Receivable 4500 Credit: Insurer Payable 3600 Credit: Partner Commission Payable 900 All entries are stored in ledger_entry — immutable, append-only.\nStep 4: COI Generation Load template version Bind policy + insured data Generate PDF Store in object storage Update certificate record with pdf_url Step 5: Emit Domain Events { \"event_type\": \"policy_issued\", \"policy_id\": \"POL1\", \"premium\": 4500, \"commission\": 900 } Event bus consumers:\nReporting pipeline Settlement service Partner webhook notification Reporting Pipeline Operational DB → CDC / Event Stream → Reporting Warehouse → IRDAI Reports / Partner Dashboards Registers generated from this issuance:\nRegister Key Data Premium Register POL1, gross: 4500, tax: 0, net: 4500 Commission Register NBFC_X, POL1, commission: 900 Insurer Payable Report InsurerA, total: 3600 Float Balance Snapshot NBFC_X, balance: old - 4500 Settlement Cycle (T+1) At settlement time:\nDebit: Insurer Payable 3600 Credit: Bank Settlement Account 3600 Debit: Partner Commission Payable 900 Credit: Partner Bank Account 900 Claims Impact on Ledger When claim is approved (reserve created):\nDebit: Claims Expense Credit: Claims Reserve When claim is paid:\nDebit: Claims Reserve Credit: Bank Account Reserve tracking feeds IRDAI reporting directly.\nPart 4 — Failure Scenarios \u0026 Recovery Scenario A: Policy Created, Ledger Fails Wrap issuance + ledger in a DB transaction, or use an event-driven compensation workflow.\nIf ledger posting fails:\nMark policy as issuance_pending Retry ledger posting Never leave a policy in issued state without corresponding ledger entries Scenario B: Ledger Posted, COI Fails Non-financial failure. Retry COI generation independently. Never reverse ledger entries for a document generation failure.\nScenario C: Float Insufficient Pre-check before issuance:\nIF float_balance \u003c premium THEN reject Or move the partner to a credit-based model.\nScenario D: Reporting Lag Reporting must be eventually consistent. Never block issuance for a reporting write.\nPart 5 — Reconciliation \u0026 Data Consistency Daily Reconciliation Jobs Compare across systems:\nLedger premium total vs. float deductions Float deductions vs. insurer payable Insurer payable vs. settlement records Detect breakage: missing ledger entries, duplicate entries, negative balances.\nProduction-Grade Guarantees Use:\nIdempotency keys on all mutating APIs Unique constraints on proposal references Immutable ledger (append-only, no updates) Versioned pricing models Event replay safety Avoid:\nUpdating ledger rows (ever) Coupling reporting DB to transactional DB Hardcoding commission logic Running reports on the operational database Architectural Observations Principle How It’s Achieved Separation of concerns Product config, transactions, ledger, and reporting are isolated bounded contexts Multi-LOB safe No LOB-specific tables — differences handled via JSON fields, cover types, and rule engine Regulatory ready Immutable ledger, audit log, versioned products, reserve tracking Partner scalable Override layer keeps partner customizations decoupled from base product Failure isolated Each subsystem can fail independently without corrupting financial state Event-driven extensibility Domain events decouple issuance from reporting, settlement, and notifications Closing Thought Embedded insurance is not just about attaching a plan to a checkout screen.\nIt is about building:\nA configurable product engine that supports multiple LOBs A reliable issuance pipeline with idempotency and failure recovery A financially correct ledger using double-entry accounting A scalable claims workflow with reserve tracking A compliant reporting backbone ready for regulatory scrutiny When designed properly, this becomes a reusable insurance infrastructure layer that can support multiple partners, multiple lines of business, multiple distribution models, high transaction scale, and strict regulatory requirements — all without rewriting the core.\n","wordCount":"2623","inLanguage":"en","datePublished":"2026-02-14T00:00:00Z","dateModified":"2026-02-14T00:00:00Z","author":{"@type":"Person","name":"Ankul Choudhry"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ankul01.github.io/profile/posts/tech-blogs/embedded-insurance/"},"publisher":{"@type":"Organization","name":"Ankul Choudhry","logo":{"@type":"ImageObject","url":"https://ankul01.github.io/profile/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://ankul01.github.io/profile/ accesskey=h title="Ankul Choudhry (Alt + H)">Ankul Choudhry</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ankul01.github.io/profile/ title=Home><span>Home</span></a></li><li><a href=https://ankul01.github.io/profile/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://ankul01.github.io/profile/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ankul01.github.io/profile/>Home</a>&nbsp;»&nbsp;<a href=https://ankul01.github.io/profile/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://ankul01.github.io/profile/posts/tech-blogs/>Tech Blogs</a></div><h1 class="post-title entry-hint-parent">Designing an Embedded Insurance Platform</h1><div class=post-description>Architecture blueprint for EMs and Staff Engineers building embedded insurance platforms — product engines, policy issuance, financial ledgers, claims workflows, and IRDAI-ready reporting.</div><div class=post-meta><span title='2026-02-14 00:00:00 +0000 UTC'>February 14, 2026</span>&nbsp;·&nbsp;<span>13 min</span>&nbsp;·&nbsp;<span>Ankul Choudhry</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#what-is-embedded-insurance>What is Embedded Insurance?</a></li><li><a href=#key-structural-concepts>Key Structural Concepts</a></li><li><a href=#part-1--platform-architecture-blueprint>Part 1 — Platform Architecture Blueprint</a><ul><li><a href=#product-hierarchy--sku-design>Product Hierarchy & SKU Design</a></li><li><a href=#integrations-layer>Integrations Layer</a></li><li><a href=#pricing-engine-grid-based>Pricing Engine (Grid-Based)</a></li><li><a href=#eligibility-engine>Eligibility Engine</a></li><li><a href=#failure-handling>Failure Handling</a></li><li><a href=#float-balance--partner-ledger>Float Balance / Partner Ledger</a></li><li><a href=#certificate-of-insurance-coi>Certificate of Insurance (COI)</a></li><li><a href=#claims-system>Claims System</a></li><li><a href=#reporting-architecture>Reporting Architecture</a></li></ul></li><li><a href=#part-2--domain-model--entity-relationship-design>Part 2 — Domain Model & Entity-Relationship Design</a><ul><li><a href=#bounded-contexts>Bounded Contexts</a></li><li><a href=#product--sku-entities>Product & SKU Entities</a></li><li><a href=#pricing--eligibility-entities>Pricing & Eligibility Entities</a></li><li><a href=#proposal--policy-issuance-entities>Proposal → Policy Issuance Entities</a></li><li><a href=#claims-entities>Claims Entities</a></li><li><a href=#finance--ledger-entities>Finance & Ledger Entities</a></li><li><a href=#partner--overlay-entities>Partner & Overlay Entities</a></li><li><a href=#full-platform-er-diagram>Full Platform ER Diagram</a></li><li><a href=#relationship-summary>Relationship Summary</a></li></ul></li><li><a href=#part-3--end-to-end-issuance-flow>Part 3 — End-to-End Issuance Flow</a><ul><li><a href=#high-level-flow>High-Level Flow</a></li><li><a href=#step-1-proposal-creation>Step 1: Proposal Creation</a></li><li><a href=#step-2-policy-issuance>Step 2: Policy Issuance</a></li><li><a href=#step-3-ledger-posting-financial-core>Step 3: Ledger Posting (Financial Core)</a></li><li><a href=#step-4-coi-generation>Step 4: COI Generation</a></li><li><a href=#step-5-emit-domain-events>Step 5: Emit Domain Events</a></li><li><a href=#reporting-pipeline>Reporting Pipeline</a></li><li><a href=#settlement-cycle-t1>Settlement Cycle (T+1)</a></li><li><a href=#claims-impact-on-ledger>Claims Impact on Ledger</a></li></ul></li><li><a href=#part-4--failure-scenarios--recovery>Part 4 — Failure Scenarios & Recovery</a><ul><li><a href=#scenario-a-policy-created-ledger-fails>Scenario A: Policy Created, Ledger Fails</a></li><li><a href=#scenario-b-ledger-posted-coi-fails>Scenario B: Ledger Posted, COI Fails</a></li><li><a href=#scenario-c-float-insufficient>Scenario C: Float Insufficient</a></li><li><a href=#scenario-d-reporting-lag>Scenario D: Reporting Lag</a></li></ul></li><li><a href=#part-5--reconciliation--data-consistency>Part 5 — Reconciliation & Data Consistency</a><ul><li><a href=#daily-reconciliation-jobs>Daily Reconciliation Jobs</a></li><li><a href=#production-grade-guarantees>Production-Grade Guarantees</a></li></ul></li><li><a href=#architectural-observations>Architectural Observations</a></li><li><a href=#closing-thought>Closing Thought</a></li></ul></nav></div></details></div><div class=post-content><h2 id=what-is-embedded-insurance>What is Embedded Insurance?<a hidden class=anchor aria-hidden=true href=#what-is-embedded-insurance>#</a></h2><p>Embedded insurance is a distribution model where insurance is integrated directly into a primary product or transaction journey — rather than sold separately through agents or aggregators.</p><p><strong>Real-world examples:</strong></p><ul><li>Device protection offered during mobile checkout</li><li>Loan protection bundled with credit disbursement</li><li>Travel insurance embedded in ticket booking</li><li>Health cover attached to a subscription plan</li></ul><p>Unlike traditional agency or bancassurance models, embedded insurance is:</p><ul><li><strong>Partner-distributed</strong> — e-commerce, fintech, NBFC, and travel platforms sell the product</li><li><strong>API-driven and real-time</strong> — no manual underwriting delays</li><li><strong>SKU-based</strong> — sellable units attached to transactions</li><li><strong>Operated under a Master Policy + Certificate of Insurance (COI) structure</strong></li><li><strong>Highly automated</strong> — across issuance, finance, and claims</li></ul><hr><h2 id=key-structural-concepts>Key Structural Concepts<a hidden class=anchor aria-hidden=true href=#key-structural-concepts>#</a></h2><p>Before diving into architecture, these domain concepts are essential:</p><table><thead><tr><th>Concept</th><th>Definition</th></tr></thead><tbody><tr><td><strong>Master Policy</strong></td><td>A single contract issued to the partner (or aggregator) covering a defined cohort of customers</td></tr><tr><td><strong>Certificate of Insurance (COI)</strong></td><td>Individual proof of coverage issued to each insured under the master policy</td></tr><tr><td><strong>SKU</strong></td><td>The smallest sellable unit — a versioned plan with specific covers and pricing rules</td></tr><tr><td><strong>Cover</strong></td><td>Risk type (e.g., accidental damage, hospitalization, death)</td></tr><tr><td><strong>Benefit</strong></td><td>Payout construct within a cover</td></tr><tr><td><strong>Underwriting</strong></td><td>Assumed as a black-box service that returns eligibility and pricing modifiers</td></tr></tbody></table><hr><h2 id=part-1--platform-architecture-blueprint>Part 1 — Platform Architecture Blueprint<a hidden class=anchor aria-hidden=true href=#part-1--platform-architecture-blueprint>#</a></h2><h3 id=product-hierarchy--sku-design>Product Hierarchy & SKU Design<a hidden class=anchor aria-hidden=true href=#product-hierarchy--sku-design>#</a></h3><p>This is the foundation of configurability. The product engine must support multiple lines of business (LOBs) without LOB-specific code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Product
</span></span><span class=line><span class=cl>  └── Plan (Versioned)
</span></span><span class=line><span class=cl>        └── Cover
</span></span><span class=line><span class=cl>              └── Benefit
</span></span><span class=line><span class=cl>                    └── Configurations
</span></span></code></pre></div><p><strong>Example SKU:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;sku_id&#34;</span><span class=p>:</span> <span class=s2>&#34;LOAN_PROTECT_V3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;lob&#34;</span><span class=p>:</span> <span class=s2>&#34;credit_life&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;covers&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;death_cover&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sum_insured_formula&#34;</span><span class=p>:</span> <span class=s2>&#34;loan_outstanding&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pricing_model&#34;</span><span class=p>:</span> <span class=s2>&#34;grid_v2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;eligibility_profile&#34;</span><span class=p>:</span> <span class=s2>&#34;loan_basic_rules&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Design Principles:</strong></p><ol><li><p><strong>Versioning is mandatory.</strong> Plans must be immutable once published. Never modify live plans — create a new version, soft-deprecate the old one, and maintain backward compatibility.</p></li><li><p><strong>Partner overlays stay separate.</strong> Partners may require custom pricing, modified eligibility, or commission overrides. Keep overrides in a separate layer from the base product definition:</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Base Plan
</span></span><span class=line><span class=cl>   +
</span></span><span class=line><span class=cl>Partner Override Layer
</span></span></code></pre></div><hr><h3 id=integrations-layer>Integrations Layer<a hidden class=anchor aria-hidden=true href=#integrations-layer>#</a></h3><p>Embedded insurance must support multiple integration modes to serve different partner types.</p><h4 id=api-based-real-time>API-Based (Real-Time)<a hidden class=anchor aria-hidden=true href=#api-based-real-time>#</a></h4><p>Used by e-commerce, fintech lending, BNPL, and wallet integrations.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Partner → Proposal API → Eligibility → Pricing → Issuance → COI
</span></span></code></pre></div><p>Design requirements:</p><ul><li>Idempotency keys on every mutating call</li><li>Versioned APIs</li><li>Async event notifications (webhooks)</li><li>Timeout-safe retry logic</li></ul><h4 id=pos--sdk-integrations>POS / SDK Integrations<a hidden class=anchor aria-hidden=true href=#pos--sdk-integrations>#</a></h4><p>Used for offline stores and agent-assisted selling:</p><ul><li>Token-based authentication</li><li>Embedded UI SDK with local validation + backend confirmation</li></ul><h4 id=offline-sftp--batch>Offline (SFTP / Batch)<a hidden class=anchor aria-hidden=true href=#offline-sftp--batch>#</a></h4><p>Used by NBFCs and enterprise partners:</p><ul><li>Batch file upload → Validation pipeline → Pricing + Eligibility → Bulk issuance → Reconciliation report</li><li>Must include file checksum validation, row-level error reporting, and reprocessing capability</li></ul><hr><h3 id=pricing-engine-grid-based>Pricing Engine (Grid-Based)<a hidden class=anchor aria-hidden=true href=#pricing-engine-grid-based>#</a></h3><p>Embedded insurance typically uses grid-based pricing rather than actuarial models at runtime.</p><p><strong>Example pricing grid:</strong></p><table><thead><tr><th>Age Band</th><th>Loan Tenure</th><th>Rate</th></tr></thead><tbody><tr><td>18–40</td><td>&lt; 24 months</td><td>0.8%</td></tr><tr><td>41–60</td><td>&lt; 24 months</td><td>1.2%</td></tr><tr><td>18–40</td><td>> 24 months</td><td>1.1%</td></tr></tbody></table><p><strong>Resolution flow:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Pricing Input → Grid Resolver → Rate Selection → Premium Calculator
</span></span></code></pre></div><p>Key considerations:</p><ul><li>Grid versioning (old grids must remain queryable)</li><li>Partner-level overrides</li><li>Preloading grids in memory for performance</li><li>Formula abstraction — no hardcoded logic</li></ul><hr><h3 id=eligibility-engine>Eligibility Engine<a hidden class=anchor aria-hidden=true href=#eligibility-engine>#</a></h3><p>Eligibility rules can be static (mandatory field validation), rule-based (config-driven), or underwriting-triggered (external service).</p><p><strong>Example Rule DSL:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>IF loan_amount &gt; 5L THEN reject
</span></span><span class=line><span class=cl>IF age &gt; 65 THEN reject
</span></span><span class=line><span class=cl>IF pincode IN blacklist THEN reject
</span></span></code></pre></div><p><strong>Fail strategy:</strong></p><ul><li><strong>Fail-closed</strong> — reject if rules are unavailable (preferred for insurance)</li><li><strong>Fail-open</strong> — allow issuance if non-critical (only with explicit approval)</li></ul><hr><h3 id=failure-handling>Failure Handling<a hidden class=anchor aria-hidden=true href=#failure-handling>#</a></h3><p>Embedded insurance platforms must handle complex failure scenarios gracefully.</p><table><thead><tr><th>Scenario</th><th>Strategy</th></tr></thead><tbody><tr><td><strong>Payment success, issuance failure</strong></td><td>Compensation workflow → Retry issuance → If irrecoverable, trigger refund + reversal entry</td></tr><tr><td><strong>PAS (Policy Admin System) timeout</strong></td><td>Async confirmation → Track <code>pending_issuance</code> state → Reconcile via event listener</td></tr><tr><td><strong>Duplicate requests</strong></td><td>Idempotency keys + unique proposal reference ID + state-based validation</td></tr></tbody></table><hr><h3 id=float-balance--partner-ledger>Float Balance / Partner Ledger<a hidden class=anchor aria-hidden=true href=#float-balance--partner-ledger>#</a></h3><p>Two common financial models:</p><table><thead><tr><th>Model</th><th>How It Works</th></tr></thead><tbody><tr><td><strong>Pre-funded (Float)</strong></td><td>Partner maintains a balance. Debit float → Issue policy</td></tr><tr><td><strong>Post-paid Commission</strong></td><td>Insurer settles commission periodically</td></tr></tbody></table><p><strong>Float ledger design (high-level):</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>partner_wallet:     | partner_id | balance |
</span></span><span class=line><span class=cl>wallet_transactions: | txn_id | partner_id | debit | credit | reference_id |
</span></span></code></pre></div><p>Settlement cycle: Daily premium collection summary → Commission deduction → Net settlement report.</p><p><strong>The ledger must be immutable.</strong></p><hr><h3 id=certificate-of-insurance-coi>Certificate of Insurance (COI)<a hidden class=anchor aria-hidden=true href=#certificate-of-insurance-coi>#</a></h3><p>COI lifecycle:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Policy Issued → Data bound to template → PDF generated → Stored in object storage → URL returned
</span></span></code></pre></div><p>Design requirements:</p><ul><li>Versioned templates with dynamic placeholders</li><li>Template audit trail</li><li>Re-generation capability</li><li>Must reference: master policy number, certificate number, coverage details</li></ul><hr><h3 id=claims-system>Claims System<a hidden class=anchor aria-hidden=true href=#claims-system>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>FNOL → Documents Pending → Assessment → Approved / Rejected → Paid
</span></span></code></pre></div><p>Key data points per claim: Claim ID, Policy reference, Reserve amount, Paid amount, Fraud flags.</p><p><strong>Reserve vs Paid</strong> — Reserve is the expected liability; Paid is the actual settlement. Reserve tracking is critical for regulatory reporting.</p><hr><h3 id=reporting-architecture>Reporting Architecture<a hidden class=anchor aria-hidden=true href=#reporting-architecture>#</a></h3><p>Embedded insurance must support both regulatory (IRDAI) and partner reporting.</p><p><strong>Core registers:</strong></p><table><thead><tr><th>Register</th><th>Key Fields</th></tr></thead><tbody><tr><td>Premium Register</td><td>policy_id, premium, tax, net</td></tr><tr><td>Claims Paid Register</td><td>claim_id, amount_paid, payout_date</td></tr><tr><td>Claims Reserve Register</td><td>claim_id, reserve_amount</td></tr><tr><td>Commission Register</td><td>partner_id, commission_amount</td></tr></tbody></table><p><strong>Architecture:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Operational DB → Event Stream → Reporting Warehouse → Regulatory / Partner Reports
</span></span></code></pre></div><p>Never run heavy reports on the transactional database.</p><p><strong>IRDAI reporting considerations:</strong> Monthly premium summaries, claim ratio reporting, product-wise data segregation, audit-ready exports.</p><hr><h2 id=part-2--domain-model--entity-relationship-design>Part 2 — Domain Model & Entity-Relationship Design<a hidden class=anchor aria-hidden=true href=#part-2--domain-model--entity-relationship-design>#</a></h2><p>This section maps the architecture into a production-grade domain model, organized by bounded context.</p><h3 id=bounded-contexts>Bounded Contexts<a hidden class=anchor aria-hidden=true href=#bounded-contexts>#</a></h3><p>The platform is organized into 6 isolated contexts:</p><ol><li><strong>Product Configuration</strong> — Product, Plan, Cover, Benefit, SKU</li><li><strong>Pricing & Eligibility</strong> — Grid models, rule definitions</li><li><strong>Policy & Issuance</strong> — Proposal, Underwriting, Policy, Certificate</li><li><strong>Claims</strong> — Claim lifecycle, documents, payments</li><li><strong>Finance & Ledger</strong> — Double-entry accounts, float wallet</li><li><strong>Partner & Overlay</strong> — Partner config, plan overrides</li></ol><hr><h3 id=product--sku-entities>Product & SKU Entities<a hidden class=anchor aria-hidden=true href=#product--sku-entities>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>product
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  name          string
</span></span><span class=line><span class=cl>  lob           string     (device / health / credit)
</span></span><span class=line><span class=cl>  status        enum       (draft / active / deprecated)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>plan
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  product_id    FK(product)
</span></span><span class=line><span class=cl>  version       integer
</span></span><span class=line><span class=cl>  effective_from date
</span></span><span class=line><span class=cl>  effective_to  date
</span></span><span class=line><span class=cl>  status        enum       ← Immutable once active
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>plan_cover
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  plan_id       FK(plan)
</span></span><span class=line><span class=cl>  cover_type    string
</span></span><span class=line><span class=cl>  sum_insured_formula string
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cover_benefit
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  plan_cover_id FK(plan_cover)
</span></span><span class=line><span class=cl>  benefit_type  string
</span></span><span class=line><span class=cl>  payout_logic  json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sku
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  plan_id       FK(plan)
</span></span><span class=line><span class=cl>  sku_code      string
</span></span><span class=line><span class=cl>  pricing_model_id FK(pricing_model)
</span></span><span class=line><span class=cl>  eligibility_profile_id FK(eligibility_profile)
</span></span></code></pre></div><p>SKU is the <strong>sellable layer</strong> — the unit partners interact with.</p><hr><h3 id=pricing--eligibility-entities>Pricing & Eligibility Entities<a hidden class=anchor aria-hidden=true href=#pricing--eligibility-entities>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>pricing_model
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  type          enum(grid / formula)
</span></span><span class=line><span class=cl>  version       integer
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pricing_grid
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  pricing_model_id FK
</span></span><span class=line><span class=cl>  param_1       string
</span></span><span class=line><span class=cl>  param_2       string
</span></span><span class=line><span class=cl>  rate          decimal
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>eligibility_profile
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  rule_definition json
</span></span><span class=line><span class=cl>  version       integer     ← Rules stored as DSL JSON
</span></span></code></pre></div><hr><h3 id=proposal--policy-issuance-entities>Proposal → Policy Issuance Entities<a hidden class=anchor aria-hidden=true href=#proposal--policy-issuance-entities>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Proposal → Underwriting Decision → Policy → Certificate
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>proposal
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  partner_id    FK(partner)
</span></span><span class=line><span class=cl>  sku_id        FK(sku)
</span></span><span class=line><span class=cl>  status        enum(draft / submitted / approved / rejected)
</span></span><span class=line><span class=cl>  premium_amount decimal
</span></span><span class=line><span class=cl>  meta          json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>underwriting_decision
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  proposal_id   FK
</span></span><span class=line><span class=cl>  decision      enum(approved / rejected / manual)
</span></span><span class=line><span class=cl>  score         decimal
</span></span><span class=line><span class=cl>  reason        string
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>policy
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  master_policy_id FK(master_policy)
</span></span><span class=line><span class=cl>  proposal_id   FK
</span></span><span class=line><span class=cl>  policy_number string
</span></span><span class=line><span class=cl>  status        enum(issued / active / cancelled / expired)
</span></span><span class=line><span class=cl>  start_date    date
</span></span><span class=line><span class=cl>  end_date      date
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>certificate
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  policy_id     FK
</span></span><span class=line><span class=cl>  certificate_number string
</span></span><span class=line><span class=cl>  pdf_url       string
</span></span><span class=line><span class=cl>  template_version integer
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>master_policy
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  insurer_reference string
</span></span><span class=line><span class=cl>  partner_id    FK
</span></span><span class=line><span class=cl>  product_id    FK
</span></span><span class=line><span class=cl>  start_date    date
</span></span><span class=line><span class=cl>  end_date      date
</span></span></code></pre></div><hr><h3 id=claims-entities>Claims Entities<a hidden class=anchor aria-hidden=true href=#claims-entities>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Policy → Claim → Claim_Event / Claim_Document / Claim_Payment
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>claim
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  policy_id     FK
</span></span><span class=line><span class=cl>  status        enum
</span></span><span class=line><span class=cl>  loss_date     date
</span></span><span class=line><span class=cl>  reserve_amount decimal
</span></span><span class=line><span class=cl>  approved_amount decimal
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>claim_event
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  claim_id      FK
</span></span><span class=line><span class=cl>  event_type    string
</span></span><span class=line><span class=cl>  created_at    timestamp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>claim_document
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  claim_id      FK
</span></span><span class=line><span class=cl>  doc_type      string
</span></span><span class=line><span class=cl>  storage_url   string
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>claim_payment
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  claim_id      FK
</span></span><span class=line><span class=cl>  amount        decimal
</span></span><span class=line><span class=cl>  payout_date   date
</span></span><span class=line><span class=cl>  payment_reference string
</span></span></code></pre></div><hr><h3 id=finance--ledger-entities>Finance & Ledger Entities<a hidden class=anchor aria-hidden=true href=#finance--ledger-entities>#</a></h3><p><strong>This is the most critical section.</strong> Never mix business tables with ledger tables.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ledger_account
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  account_type  enum(premium_receivable, insurer_payable,
</span></span><span class=line><span class=cl>                     commission_payable, claims_payable)
</span></span><span class=line><span class=cl>  owner_type    enum(system, partner, insurer)
</span></span><span class=line><span class=cl>  owner_id      UUID
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ledger_entry                    ← IMMUTABLE TABLE
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  debit_account_id  FK
</span></span><span class=line><span class=cl>  credit_account_id FK
</span></span><span class=line><span class=cl>  amount        decimal
</span></span><span class=line><span class=cl>  reference_type enum(policy, claim, refund)
</span></span><span class=line><span class=cl>  reference_id  UUID
</span></span><span class=line><span class=cl>  created_at    timestamp
</span></span></code></pre></div><p><strong>Float wallet:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>partner_wallet
</span></span><span class=line><span class=cl>  partner_id    UUID
</span></span><span class=line><span class=cl>  balance       decimal
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wallet_txn
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  partner_id    UUID
</span></span><span class=line><span class=cl>  debit         decimal
</span></span><span class=line><span class=cl>  credit        decimal
</span></span><span class=line><span class=cl>  reference_id  UUID
</span></span></code></pre></div><hr><h3 id=partner--overlay-entities>Partner & Overlay Entities<a hidden class=anchor aria-hidden=true href=#partner--overlay-entities>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>partner
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  name          string
</span></span><span class=line><span class=cl>  integration_mode enum(api / pos / batch)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>partner_plan_override
</span></span><span class=line><span class=cl>  id            UUID
</span></span><span class=line><span class=cl>  partner_id    FK
</span></span><span class=line><span class=cl>  sku_id        FK
</span></span><span class=line><span class=cl>  pricing_override json
</span></span><span class=line><span class=cl>  commission_override decimal
</span></span></code></pre></div><hr><h3 id=full-platform-er-diagram>Full Platform ER Diagram<a hidden class=anchor aria-hidden=true href=#full-platform-er-diagram>#</a></h3><p>Below is the complete entity-relationship diagram in Mermaid syntax. You can render it in any Mermaid-compatible tool.</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>erDiagram

    %% ── PARTNER CONTEXT ──
    PARTNER {
        UUID id
        string name
        string integration_mode
    }
    MASTER_POLICY {
        UUID id
        UUID partner_id
        UUID product_id
        string insurer_reference
        date start_date
        date end_date
    }
    PARTNER ||--o{ MASTER_POLICY : owns

    %% ── PRODUCT CONFIGURATION ──
    PRODUCT {
        UUID id
        string name
        string lob
        string status
    }
    PLAN {
        UUID id
        UUID product_id
        int version
        date effective_from
        date effective_to
        string status
    }
    PLAN_COVER {
        UUID id
        UUID plan_id
        string cover_type
        string sum_insured_formula
    }
    COVER_BENEFIT {
        UUID id
        UUID plan_cover_id
        string benefit_type
        json payout_logic
    }
    SKU {
        UUID id
        UUID plan_id
        string sku_code
        UUID pricing_model_id
        UUID eligibility_profile_id
    }
    PRODUCT ||--o{ PLAN : contains
    PLAN ||--o{ PLAN_COVER : defines
    PLAN_COVER ||--o{ COVER_BENEFIT : includes
    PLAN ||--o{ SKU : sellable_unit

    %% ── PRICING &amp; ELIGIBILITY ──
    PRICING_MODEL {
        UUID id
        string type
        int version
    }
    PRICING_GRID {
        UUID id
        UUID pricing_model_id
        string param_1
        string param_2
        decimal rate
    }
    ELIGIBILITY_PROFILE {
        UUID id
        json rule_definition
        int version
    }
    PRICING_MODEL ||--o{ PRICING_GRID : defines
    SKU }o--|| PRICING_MODEL : uses
    SKU }o--|| ELIGIBILITY_PROFILE : validated_by

    %% ── PROPOSAL &amp; POLICY ──
    PROPOSAL {
        UUID id
        UUID partner_id
        UUID sku_id
        string status
        decimal premium_amount
        json meta
    }
    UNDERWRITING_DECISION {
        UUID id
        UUID proposal_id
        string decision
        decimal score
        string reason
    }
    POLICY {
        UUID id
        UUID master_policy_id
        UUID proposal_id
        string policy_number
        string status
        date start_date
        date end_date
    }
    CERTIFICATE {
        UUID id
        UUID policy_id
        string certificate_number
        string pdf_url
        int template_version
    }
    PARTNER ||--o{ PROPOSAL : initiates
    SKU ||--o{ PROPOSAL : selected_in
    PROPOSAL ||--|| UNDERWRITING_DECISION : evaluated_by
    PROPOSAL ||--|| POLICY : converts_to
    MASTER_POLICY ||--o{ POLICY : governs
    POLICY ||--|| CERTIFICATE : generates

    %% ── CLAIMS CONTEXT ──
    CLAIM {
        UUID id
        UUID policy_id
        string status
        date loss_date
        decimal reserve_amount
        decimal approved_amount
    }
    CLAIM_EVENT {
        UUID id
        UUID claim_id
        string event_type
        datetime created_at
    }
    CLAIM_DOCUMENT {
        UUID id
        UUID claim_id
        string doc_type
        string storage_url
    }
    CLAIM_PAYMENT {
        UUID id
        UUID claim_id
        decimal amount
        date payout_date
    }
    POLICY ||--o{ CLAIM : triggers
    CLAIM ||--o{ CLAIM_EVENT : tracks
    CLAIM ||--o{ CLAIM_DOCUMENT : attaches
    CLAIM ||--o{ CLAIM_PAYMENT : settles

    %% ── FINANCE &amp; LEDGER ──
    LEDGER_ACCOUNT {
        UUID id
        string account_type
        string owner_type
        UUID owner_id
    }
    LEDGER_ENTRY {
        UUID id
        UUID debit_account_id
        UUID credit_account_id
        decimal amount
        string reference_type
        UUID reference_id
        datetime created_at
    }
    LEDGER_ACCOUNT ||--o{ LEDGER_ENTRY : participates
    POLICY ||--o{ LEDGER_ENTRY : premium_related
    CLAIM ||--o{ LEDGER_ENTRY : payout_related

    %% ── PARTNER FLOAT WALLET ──
    PARTNER_WALLET {
        UUID partner_id
        decimal balance
    }
    WALLET_TXN {
        UUID id
        UUID partner_id
        decimal debit
        decimal credit
        UUID reference_id
    }
    PARTNER ||--|| PARTNER_WALLET : has
    PARTNER_WALLET ||--o{ WALLET_TXN : records

    %% ── REPORTING LAYER ──
    PREMIUM_REGISTER {
        UUID policy_id
        decimal premium
        decimal tax
        decimal net
    }
    CLAIMS_PAID_REGISTER {
        UUID claim_id
        decimal amount_paid
    }
    CLAIMS_RESERVE_REGISTER {
        UUID claim_id
        decimal reserve_amount
    }
    COMMISSION_REGISTER {
        UUID partner_id
        decimal commission
    }
    POLICY ||--o{ PREMIUM_REGISTER : reported_in
    CLAIM ||--o{ CLAIMS_PAID_REGISTER : reported_in
    CLAIM ||--o{ CLAIMS_RESERVE_REGISTER : reported_in
    PARTNER ||--o{ COMMISSION_REGISTER : earns
</code></pre><h3 id=relationship-summary>Relationship Summary<a hidden class=anchor aria-hidden=true href=#relationship-summary>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Partner
</span></span><span class=line><span class=cl>   └── Master_Policy
</span></span><span class=line><span class=cl>         └── Policy
</span></span><span class=line><span class=cl>               └── Certificate
</span></span><span class=line><span class=cl>               └── Claim → Claim_Payment
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Product
</span></span><span class=line><span class=cl>   └── Plan
</span></span><span class=line><span class=cl>         └── SKU
</span></span><span class=line><span class=cl>               └── Proposal → Policy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Policy / Claim → Ledger_Entry
</span></span></code></pre></div><hr><h2 id=part-3--end-to-end-issuance-flow>Part 3 — End-to-End Issuance Flow<a hidden class=anchor aria-hidden=true href=#part-3--end-to-end-issuance-flow>#</a></h2><p>This section moves from static design to <strong>runtime system behavior</strong>. We walk through a complete issuance cycle for a loan protection product using a pre-funded float model.</p><blockquote><p><strong>Scenario:</strong> Partner is an NBFC. Product is Loan Protection Insurance. Financial model is pre-funded float. Underwriting is abstracted (assume approval).</p></blockquote><h3 id=high-level-flow>High-Level Flow<a hidden class=anchor aria-hidden=true href=#high-level-flow>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Partner → Proposal API → Eligibility → Pricing → Underwriting
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>Policy Issuance
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>Ledger Posting (Premium, Commission, Insurer Payable)
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>COI Generation
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>Event Emission
</span></span><span class=line><span class=cl>    ↓
</span></span><span class=line><span class=cl>Reporting Pipeline
</span></span></code></pre></div><hr><h3 id=step-1-proposal-creation>Step 1: Proposal Creation<a hidden class=anchor aria-hidden=true href=#step-1-proposal-creation>#</a></h3><p><strong>API request:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;partner_id&#34;</span><span class=p>:</span> <span class=s2>&#34;NBFC_X&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;sku_id&#34;</span><span class=p>:</span> <span class=s2>&#34;LOAN_PROTECT_V3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;insured&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;loan_amount&#34;</span><span class=p>:</span> <span class=mi>500000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tenure&#34;</span><span class=p>:</span> <span class=mi>36</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;idempotency_key&#34;</span><span class=p>:</span> <span class=s2>&#34;loan_12345&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>System actions:</strong></p><ol><li>Validate partner</li><li>Fetch SKU + plan version</li><li>Run eligibility rules</li><li>Resolve pricing grid</li><li>Call underwriting engine (abstracted)</li><li>Persist proposal</li></ol><p><strong>Database writes:</strong></p><table><thead><tr><th>Table</th><th>id</th><th>status</th><th>premium</th></tr></thead><tbody><tr><td>proposal</td><td>P1</td><td>approved</td><td>4500</td></tr></tbody></table><table><thead><tr><th>Table</th><th>proposal_id</th><th>decision</th></tr></thead><tbody><tr><td>underwriting_decision</td><td>P1</td><td>approved</td></tr></tbody></table><hr><h3 id=step-2-policy-issuance>Step 2: Policy Issuance<a hidden class=anchor aria-hidden=true href=#step-2-policy-issuance>#</a></h3><p>Issuance <strong>must be idempotent</strong>. Issuance and ledger posting must occur in a <strong>single atomic transaction</strong> or with event-sourced compensation.</p><p><strong>Database writes:</strong></p><table><thead><tr><th>Table</th><th>id</th><th>proposal_id</th><th>status</th></tr></thead><tbody><tr><td>policy</td><td>POL1</td><td>P1</td><td>issued</td></tr></tbody></table><table><thead><tr><th>Table</th><th>id</th><th>policy_id</th><th>certificate_no</th></tr></thead><tbody><tr><td>certificate</td><td>C1</td><td>POL1</td><td>CERT_123</td></tr></tbody></table><hr><h3 id=step-3-ledger-posting-financial-core>Step 3: Ledger Posting (Financial Core)<a hidden class=anchor aria-hidden=true href=#step-3-ledger-posting-financial-core>#</a></h3><p><strong>This is where most naive systems fail.</strong></p><p>Assume: Premium = 4500, Commission = 900, Insurer share = 3600.</p><p><strong>Ledger accounts involved:</strong></p><table><thead><tr><th>Account</th><th>Owner</th></tr></thead><tbody><tr><td>Premium Receivable</td><td>System</td></tr><tr><td>Insurer Payable</td><td>Insurer</td></tr><tr><td>Partner Commission Payable</td><td>Partner</td></tr><tr><td>Partner Float Wallet</td><td>Partner</td></tr></tbody></table><p><strong>Journal entries (double-entry):</strong></p><p><strong>Entry 1 — Deduct float:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Debit:  Partner Float Wallet        4500
</span></span><span class=line><span class=cl>Credit: Premium Receivable          4500
</span></span></code></pre></div><p><strong>Entry 2 — Allocate premium to insurer:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Debit:  Premium Receivable          4500
</span></span><span class=line><span class=cl>Credit: Insurer Payable             3600
</span></span><span class=line><span class=cl>Credit: Partner Commission Payable   900
</span></span></code></pre></div><p>All entries are stored in <code>ledger_entry</code> — <strong>immutable, append-only</strong>.</p><hr><h3 id=step-4-coi-generation>Step 4: COI Generation<a hidden class=anchor aria-hidden=true href=#step-4-coi-generation>#</a></h3><ol><li>Load template version</li><li>Bind policy + insured data</li><li>Generate PDF</li><li>Store in object storage</li><li>Update certificate record with <code>pdf_url</code></li></ol><hr><h3 id=step-5-emit-domain-events>Step 5: Emit Domain Events<a hidden class=anchor aria-hidden=true href=#step-5-emit-domain-events>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event_type&#34;</span><span class=p>:</span> <span class=s2>&#34;policy_issued&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;policy_id&#34;</span><span class=p>:</span> <span class=s2>&#34;POL1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;premium&#34;</span><span class=p>:</span> <span class=mi>4500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;commission&#34;</span><span class=p>:</span> <span class=mi>900</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Event bus consumers:</strong></p><ul><li>Reporting pipeline</li><li>Settlement service</li><li>Partner webhook notification</li></ul><hr><h3 id=reporting-pipeline>Reporting Pipeline<a hidden class=anchor aria-hidden=true href=#reporting-pipeline>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Operational DB → CDC / Event Stream → Reporting Warehouse → IRDAI Reports / Partner Dashboards
</span></span></code></pre></div><p><strong>Registers generated from this issuance:</strong></p><table><thead><tr><th>Register</th><th>Key Data</th></tr></thead><tbody><tr><td>Premium Register</td><td>POL1, gross: 4500, tax: 0, net: 4500</td></tr><tr><td>Commission Register</td><td>NBFC_X, POL1, commission: 900</td></tr><tr><td>Insurer Payable Report</td><td>InsurerA, total: 3600</td></tr><tr><td>Float Balance Snapshot</td><td>NBFC_X, balance: old - 4500</td></tr></tbody></table><hr><h3 id=settlement-cycle-t1>Settlement Cycle (T+1)<a hidden class=anchor aria-hidden=true href=#settlement-cycle-t1>#</a></h3><p>At settlement time:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Debit:  Insurer Payable                3600
</span></span><span class=line><span class=cl>Credit: Bank Settlement Account        3600
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Debit:  Partner Commission Payable      900
</span></span><span class=line><span class=cl>Credit: Partner Bank Account            900
</span></span></code></pre></div><hr><h3 id=claims-impact-on-ledger>Claims Impact on Ledger<a hidden class=anchor aria-hidden=true href=#claims-impact-on-ledger>#</a></h3><p><strong>When claim is approved (reserve created):</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Debit:  Claims Expense
</span></span><span class=line><span class=cl>Credit: Claims Reserve
</span></span></code></pre></div><p><strong>When claim is paid:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Debit:  Claims Reserve
</span></span><span class=line><span class=cl>Credit: Bank Account
</span></span></code></pre></div><p>Reserve tracking feeds IRDAI reporting directly.</p><hr><h2 id=part-4--failure-scenarios--recovery>Part 4 — Failure Scenarios & Recovery<a hidden class=anchor aria-hidden=true href=#part-4--failure-scenarios--recovery>#</a></h2><h3 id=scenario-a-policy-created-ledger-fails>Scenario A: Policy Created, Ledger Fails<a hidden class=anchor aria-hidden=true href=#scenario-a-policy-created-ledger-fails>#</a></h3><p>Wrap issuance + ledger in a DB transaction, <strong>or</strong> use an event-driven compensation workflow.</p><p>If ledger posting fails:</p><ol><li>Mark policy as <code>issuance_pending</code></li><li>Retry ledger posting</li><li>Never leave a policy in <code>issued</code> state without corresponding ledger entries</li></ol><h3 id=scenario-b-ledger-posted-coi-fails>Scenario B: Ledger Posted, COI Fails<a hidden class=anchor aria-hidden=true href=#scenario-b-ledger-posted-coi-fails>#</a></h3><p>Non-financial failure. Retry COI generation independently. <strong>Never reverse ledger entries for a document generation failure.</strong></p><h3 id=scenario-c-float-insufficient>Scenario C: Float Insufficient<a hidden class=anchor aria-hidden=true href=#scenario-c-float-insufficient>#</a></h3><p>Pre-check before issuance:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>IF float_balance &lt; premium THEN reject
</span></span></code></pre></div><p>Or move the partner to a credit-based model.</p><h3 id=scenario-d-reporting-lag>Scenario D: Reporting Lag<a hidden class=anchor aria-hidden=true href=#scenario-d-reporting-lag>#</a></h3><p>Reporting must be <strong>eventually consistent</strong>. Never block issuance for a reporting write.</p><hr><h2 id=part-5--reconciliation--data-consistency>Part 5 — Reconciliation & Data Consistency<a hidden class=anchor aria-hidden=true href=#part-5--reconciliation--data-consistency>#</a></h2><h3 id=daily-reconciliation-jobs>Daily Reconciliation Jobs<a hidden class=anchor aria-hidden=true href=#daily-reconciliation-jobs>#</a></h3><p>Compare across systems:</p><ul><li>Ledger premium total vs. float deductions</li><li>Float deductions vs. insurer payable</li><li>Insurer payable vs. settlement records</li></ul><p>Detect breakage: missing ledger entries, duplicate entries, negative balances.</p><h3 id=production-grade-guarantees>Production-Grade Guarantees<a hidden class=anchor aria-hidden=true href=#production-grade-guarantees>#</a></h3><p><strong>Use:</strong></p><ul><li>Idempotency keys on all mutating APIs</li><li>Unique constraints on proposal references</li><li>Immutable ledger (append-only, no updates)</li><li>Versioned pricing models</li><li>Event replay safety</li></ul><p><strong>Avoid:</strong></p><ul><li>Updating ledger rows (ever)</li><li>Coupling reporting DB to transactional DB</li><li>Hardcoding commission logic</li><li>Running reports on the operational database</li></ul><hr><h2 id=architectural-observations>Architectural Observations<a hidden class=anchor aria-hidden=true href=#architectural-observations>#</a></h2><table><thead><tr><th>Principle</th><th>How It&rsquo;s Achieved</th></tr></thead><tbody><tr><td><strong>Separation of concerns</strong></td><td>Product config, transactions, ledger, and reporting are isolated bounded contexts</td></tr><tr><td><strong>Multi-LOB safe</strong></td><td>No LOB-specific tables — differences handled via JSON fields, cover types, and rule engine</td></tr><tr><td><strong>Regulatory ready</strong></td><td>Immutable ledger, audit log, versioned products, reserve tracking</td></tr><tr><td><strong>Partner scalable</strong></td><td>Override layer keeps partner customizations decoupled from base product</td></tr><tr><td><strong>Failure isolated</strong></td><td>Each subsystem can fail independently without corrupting financial state</td></tr><tr><td><strong>Event-driven extensibility</strong></td><td>Domain events decouple issuance from reporting, settlement, and notifications</td></tr></tbody></table><hr><h2 id=closing-thought>Closing Thought<a hidden class=anchor aria-hidden=true href=#closing-thought>#</a></h2><p>Embedded insurance is not just about attaching a plan to a checkout screen.</p><p>It is about building:</p><ul><li>A <strong>configurable product engine</strong> that supports multiple LOBs</li><li>A <strong>reliable issuance pipeline</strong> with idempotency and failure recovery</li><li>A <strong>financially correct ledger</strong> using double-entry accounting</li><li>A <strong>scalable claims workflow</strong> with reserve tracking</li><li>A <strong>compliant reporting backbone</strong> ready for regulatory scrutiny</li></ul><p>When designed properly, this becomes a <strong>reusable insurance infrastructure layer</strong> that can support multiple partners, multiple lines of business, multiple distribution models, high transaction scale, and strict regulatory requirements — all without rewriting the core.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ankul01.github.io/profile/tags/system-design/>System-Design</a></li><li><a href=https://ankul01.github.io/profile/tags/insurance/>Insurance</a></li><li><a href=https://ankul01.github.io/profile/tags/platform-engineering/>Platform-Engineering</a></li><li><a href=https://ankul01.github.io/profile/tags/architecture/>Architecture</a></li><li><a href=https://ankul01.github.io/profile/tags/fintech/>Fintech</a></li></ul></footer></article></main><footer class=footer><div class=footer-social-icons><a href=https://www.linkedin.com/in/ankul-choudhry target=_blank rel="noopener noreferrer me" title=LinkedIn aria-label=LinkedIn><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a><a href=mailto:ankulnitt@gmail.com target=_blank rel="noopener noreferrer me" title=Email aria-label=Email><svg viewBox="0 0 24 21" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</a><a href=https://github.com/ankul01 target=_blank rel="noopener noreferrer me" title=GitHub aria-label=GitHub><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div><span>&copy; 2026 <a href=https://ankul01.github.io/profile/>Ankul Choudhry</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>